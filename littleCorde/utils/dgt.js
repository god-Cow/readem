/*
*微信小程序sdk   dgt.js v1.02
*2018-5-28
*/
(function () { function B(a) { var f = function (a, b) { return a << b | a >>> 32 - b }, h = function (a) { var b = "", c, e; for (c = 7; 0 <= c; c--)e = a >>> 4 * c & 15, b += e.toString(16); return b }, c, e, g = [], n = 1732584193, r = 4023233417, w = 2562383102, b = 271733878, t = 3285377520, k, p, q, u, v, m = []; a = unescape(encodeURIComponent(a)); k = a.length; for (c = 0; c < k - 3; c += 4)e = a.charCodeAt(c) << 24 | a.charCodeAt(c + 1) << 16 | a.charCodeAt(c + 2) << 8 | a.charCodeAt(c + 3), m.push(e); switch (k & 3) { case 0: c = 2147483648; break; case 1: c = a.charCodeAt(k - 1) << 24 | 8388608; break; case 2: c = a.charCodeAt(k - 2) << 24 | a.charCodeAt(k - 1) << 16 | 32768; break; case 3: c = a.charCodeAt(k - 3) << 24 | a.charCodeAt(k - 2) << 16 | a.charCodeAt(k - 1) << 8 | 128 }for (m.push(c); 14 !== (m.length & 15);)m.push(0); m.push(k >>> 29); m.push(k << 3 & 4294967295); for (a = 0; a < m.length; a += 16) { for (c = 0; 16 > c; c++)g[c] = m[a + c]; for (c = 16; 79 >= c; c++)g[c] = f(g[c - 3] ^ g[c - 8] ^ g[c - 14] ^ g[c - 16], 1); e = n; k = r; p = w; q = b; u = t; for (c = 0; 19 >= c; c++)v = f(e, 5) + (k & p | ~k & q) + u + g[c] + 1518500249 & 4294967295, u = q, q = p, p = f(k, 30), k = e, e = v; for (c = 20; 39 >= c; c++)v = f(e, 5) + (k ^ p ^ q) + u + g[c] + 1859775393 & 4294967295, u = q, q = p, p = f(k, 30), k = e, e = v; for (c = 40; 59 >= c; c++)v = f(e, 5) + (k & p | k & q | p & q) + u + g[c] + 2400959708 & 4294967295, u = q, q = p, p = f(k, 30), k = e, e = v; for (c = 60; 79 >= c; c++)v = f(e, 5) + (k ^ p ^ q) + u + g[c] + 3395469782 & 4294967295, u = q, q = p, p = f(k, 30), k = e, e = v; n = n + e & 4294967295; r = r + k & 4294967295; w = w + p & 4294967295; b = b + q & 4294967295; t = t + u & 4294967295 } v = h(n) + h(r) + h(w) + h(b) + h(t); return v.toLowerCase() } function G(a, f) { m(a, f, !1) } function H(a) { a && m("userid", a, !0) } function I(a) { a && m("url", a, !0) } function J(a) { a && l("gender", a, !0) } function K(a) { a && m("age", a, !0) } function L(a) { a && m("role", a, !0) } function M(a) { a && m("level", a, !0) } function N(a) { a && m("province", a, !0) } function O(a) { a && m("city", a, !0) } function P(a, f, h) { try { if ("" != a && null != a && void 0 != a && "view" != a && "behave" != a) { var c = "\x26"; if (f instanceof Array && h instanceof Array) for (var e = 0; e < f.length; e++)void 0 != h[e] && null != h[e] && (c += "\x26" + [f[e]] + "\x3d" + encodeURIComponent(h[e])); else void 0 != f && null != f && "" != f && (c += "\x26" + [f] + "\x3d" + encodeURIComponent(h)); A(a, c) } } catch (g) { console.log("error:trackEventCallback") } } function m(a, f, h) { try { var c = "dgt_attr" + x.appkey, e = wx.getStorageSync(c); "" == e && (e = {}); if (name instanceof Array && f instanceof Array) for (var g = 0; g < a.length; g++)void 0 != f[g] && null != f[g] && (h ? e[a[g]] = encodeURIComponent(f[g]) : e["a_" + a[g]] = encodeURIComponent(f[g])); else h ? e[a] = encodeURIComponent(f) : e["a_" + a] = encodeURIComponent(f); wx.setStorageSync(c, e) } catch (T) { console.log("error:trackAttrCallback") } } function A(a, f) { var h, c, e, g, m, r, w, b; c = Math.round((new Date).getTime() / 1E3); b = wx.getStorageSync("dgt" + x.appkey); b = (b = 0 == b.length ? null : b) ? b.split("|||") : ["1", B(JSON.stringify(wx.getSystemInfoSync()) + (new Date).getTime() + Math.random()).slice(0, 16), c, 0, c, "", ""]; h = b[0]; c = b[1]; e = b[2]; g = b[3]; m = b[4]; r = b[5]; w = b[6]; var t; b = C; if (void 0 != b || "" != b || null != b) b = { utm_source: b.utm_source = void 0 != b.utm_source ? b.utm_source : "", utm_campaign: b.utm_campaign = void 0 != b.utm_campaign ? b.utm_campaign : "", utm_medium: b.utm_medium = void 0 != b.utm_medium ? b.utm_medium : "", utm_content: b.utm_content = void 0 != b.utm_content ? b.utm_content : "", utm_term: b.utm_term = void 0 != b.utm_term ? b.utm_term : "" }, t = JSON.stringify(b); var k = ""; void 0 != t && "" != t && "undefined" != t && (b = JSON.parse(t), k = (b.utm_source ? "utm_source\x3d" + b.utm_source : "") + (b.utm_campaign ? "\x26utm_campaign\x3d" + b.utm_campaign : "") + (b.utm_medium ? "\x26utm_medium\x3d" + b.utm_medium : "") + (b.utm_content ? "\x26utm_content\x3d" + b.utm_content : "") + (b.utm_term ? "\x26utm_term\x3d" + b.utm_term : "")); t = Math.round((new Date).getTime() / 1E3); b = wx.getStorageSync("dgt_attr" + x.appkey); b = void 0 != b && "" != b ? b : {}; !r || 1800 < t - r ? (g = 1, w = B(c + m).slice(0, 16), h = r ? 0 : 1) : "view" == a && g++; r = m; m = Math.round((new Date).getTime() / 1E3); wx.setStorageSync("dgt" + x.appkey, h + "|||" + c + "|||" + e + "|||" + g + "|||" + m + "|||" + r + "|||" + w + "|||"); e = new Date(1E3 * ~~e); r = 9 < e.getMonth() + 1 ? e.getMonth() + 1 : "0" + (e.getMonth() + 1); m = 9 < e.getDate() ? e.getDate() : "0" + e.getDate(); e = e.getFullYear() + "-" + r + "-" + m; h = "a\x3d" + x.appkey + "\x26b\x3d" + c + "\x26c\x3d" + w + "\x26e\x3d" + a + "\x26f\x3d" + encodeURIComponent(getCurrentPages()[getCurrentPages().length - 1].route) + "\x26g\x3d\x26i\x3d" + h + "\x26j\x3d" + (new Date).getTime() + "\x26k\x3d\x26l\x3dphone\x26m\x3d\x26n\x3d" + n.model + "\x26o\x3d" + n.system_n + "\x26p\x3d" + n.system_v + "\x26q\x3d" + x.appversion + "\x26r\x3dWebchatApp\x26s\x3d" + n.windowWidth + "x" + n.windowHeight + "\x26t\x3d0\x26u\x3d" + n.networkType + "\x26v\x3d0\x26w\x3d0\x26x\x3d0\x26y\x3d0\x26z\x3d0\x26aa\x3d0\x26ab\x3d0\x26ac\x3d0\x26ad\x3d0\x26af\x3d\x26ag\x3d\x26ah\x3d\x26ai\x3d\x26ak\x3d\x26al\x3d\x26am\x3d\x26an\x3d\x26ao\x3d" + g + "\x26ap\x3d" + (b.userid ? b.userid : "") + "\x26aq\x3d" + (b.url && "undefined" != b.url ? b.url : "") + "\x26ar\x3d" + (b.gender ? b.gender : "") + "\x26as\x3d" + (b.age ? b.age : "") + "\x26at\x3d" + (b.role ? b.role : "") + "\x26au\x3d" + (b.level ? d.level : "") + "\x26av\x3d" + (b.province ? b.province : "") + "\x26aw\x3d" + (b.city ? b.city : "") + "\x26ax\x3d\x26ay\x3d\x26az\x3d\x26ba\x3d" + n.language + "\x26bb\x3d\x26bc\x3d\x26bd\x3d"; g = getCurrentPages(); g = 1 < g.length ? encodeURIComponent(g[g.length - 2].route) : ""; h = h + g + "\x26be\x3d\x26bf\x3d" + n.windowWidth + "\x26bg\x3d" + n.windowHeight + "\x26bh\x3d\x26bi\x3d\x26bj\x3d" + e + "\x26bl\x3d" + encodeURIComponent(k) + "\x26bm\x3d\x26bn\x3d\x26bo\x3d\x26bp\x3d\x26bq\x3d\x26br\x3d\x26bs\x3d\x26bt\x3d"; switch (a) { case "behave": a = (new Date).getTime(), g = a - D, D = a, h.replace("\x26g\x3d\x26", "\x26g\x3d" + g + "\x26") }if (0 != b) for (var p in b) -1 != p.indexof("a_") && (h += "\x26" + p + "\x3d" + b[p]); void 0 != h && (h += f); wx.request({ url: "https://shujike.cn/dgt_produce.cgi?tp\x3d5", data: h, method: "POST", header: { Cookie: "sjkid\x3d" + c } })} function z(a, f, h) { if (a[f]) { var c = a[f]; a[f] = function (a) { h.call(this, a, f); c.call(this, a) } } else a[f] = function (a) { h.call(this, a, f) } } var x = require("./dgt-config.js"), C; if (void 0 == x.appkey || 16 > x.appkey.length) console.log("\u6570\u6781\u5ba2\u65e5\u5fd7:appkey\u9519\u8bef"); else { var n = wx.getSystemInfoSync(), D = (new Date).getTime(), y = n.system.split(" "); n.system_n = y[0]; 0 < parseInt(y[y.length - 1]) ? n.system_v = y[y.length - 1] : n.system_v = 0; n.networkType = 5; wx.getNetworkType({ success: function (a) { switch (a.networkType) { case "2g": n.networkType = "1"; break; case "3g": n.networkType = "2"; break; case "4g": n.networkType = "3"; break; case "wifi": n.networkType = "4" } } }); var E = !0, F = function (a, f) { A("behave") }, Q = function (a, f) { A("view") }, R = function (a, f) { C = a; E && (a = getApp(), a._dgt = {}, a._dgt.track_userid = H, a._dgt.track_url = I, a._dgt.track_gender = J, a._dgt.track_age = K, a._dgt.track_role = L, a._dgt.track_level = M, a._dgt.track_province = N, a._dgt.track_city = O, a._dgt.trackAttr = G, a._dgt.trackEvent = P, E = !1) }, S = Page; Page = function (a) { z(a, "onUnload", F); z(a, "onShow", Q); z(a, "onHide", F); z(a, "onLoad", R); S(a) } } })();